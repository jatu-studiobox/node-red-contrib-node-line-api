<style>
    .labelDisabled {
        color: darkgray;
        cursor: not-allowed !important;
    }

    .containerBox {
        width: 100%;
        padding: 5px;
        border: 1px solid #bbb;
        border-radius: 5px;
        padding-bottom: 8px;
        margin-bottom: 10px;
    }

    .mandatory {
        color: #d6615f;
    }

    .lblTime {
        margin-left: 10px;
    }

    .error-box {
        border: solid 1px #d6615f !important;
    }

    .errorInvalidInitialDatetime,
    .errorInvalidMinDatetime,
    .errorInvalidMaxDatetime {
        color: #d6615f;
    }
</style>
<script type="text/html" data-template-name="node-line-bot-quick-reply-item">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-line-bot-quick-reply-item.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name" />
    </div>
    <div class="containerBox" style="color: #555;">
        <div style="color: #555; display: flex; flex-direction: row; gap: 10px;">
            <div style="flex-grow: 1">
                <i class="fa fa-cogs"></i> <span data-i18n="node-line-bot-quick-reply-item.label.configQuickReply"></span></label>
            </div>
            <div style="flex-grow: 1; display: flex; flex-direction: row; justify-content: flex-end; gap: 5px;">
                <input type="checkbox" id="node-input-useQuickReplyItem" />
                <label for="node-input-useQuickReplyItem"><span data-i18n="node-line-bot-quick-reply-item.label.useQuickReplyItem"></span></label>
            </div>
        </div>
        <div>
            <div class="form-row">
                <label for="node-input-action"><span data-i18n="node-line-bot-quick-reply-item.label.actionQuickReply"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-action" />
            </div>
            <div class="form-row">
                <label for="node-input-imageUrl"><span data-i18n="node-line-bot-quick-reply-item.label.imageUrl"></span></label>
                <input type="text" id="node-input-imageUrl" />
                <div style="margin-top: 3px; font-size: 0.9em;">
                    <span data-i18n="node-line-bot-quick-reply-item.label.concernImageUrl"></span>
                </div>
            </div>
            <div class="form-row">
                <label for="node-input-replyLabel"><span data-i18n="node-line-bot-quick-reply-item.label.replyLabel"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-replyLabel" />
            </div>
            <div class="form-row postback">
                <label for="node-input-postbackData"><span data-i18n="node-line-bot-quick-reply-item.label.postbackData"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-postbackData" placeholder="storeId=12345" />
            </div>
            <div class="form-row postback">
                <label for="node-input-postbackDisplayText"><span data-i18n="node-line-bot-quick-reply-item.label.postbackDisplayText"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-postbackDisplayText" />
            </div>
            <div class="form-row message">
                <label for="node-input-messageText"><span data-i18n="node-line-bot-quick-reply-item.label.messageText"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-messageText" />
            </div>
            <div class="form-row uri">
                <label for="node-input-uri"><span data-i18n="node-line-bot-quick-reply-item.label.uri"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-uri" />
            </div>
            <div class="form-row uri">
                <label for="node-input-altUriDesktop"><span data-i18n="node-line-bot-quick-reply-item.label.altUriDesktop"></span></label>
                <input type="text" id="node-input-altUriDesktop" />
            </div>
            <div class="form-row uri">
                <div style="margin-top: 3px; font-size: 0.9em;">
                    <span data-i18n="node-line-bot-quick-reply-item.label.concernUrl"></span><br />
                    <a target="_blank" href="https://developers.line.biz/en/docs/messaging-api/using-line-url-scheme/"><i class="fa fa-external-link"></i>  <span data-i18n="node-line-bot-quick-reply-item.label.concertUrlLink"></span></a><br />
                    <span data-i18n="node-line-bot-quick-reply-item.label.consertUrlExample1"></span><br />
                    <span data-i18n="node-line-bot-quick-reply-item.label.consertUrlExample2"></span><br />
                    <span data-i18n="node-line-bot-quick-reply-item.label.consertUrlExample3"></span>
                </div>
            </div>
            <div class="form-row datetimepicker">
                <label for="node-input-datetimeData"><span data-i18n="node-line-bot-quick-reply-item.label.datetimeData"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-datetimeData" placeholder="storeId=12345" />
            </div>
            <div class="form-row datetimepicker">
                <label for="node-input-datetimeMode"><span data-i18n="node-line-bot-quick-reply-item.label.datetimeMode"></span> <span class="mandatory">*</span></label>
                <input type="text" id="node-input-datetimeMode" />
                <input type="hidden" id="node-input-selectedDatetimeMode" />
            </div>
            <div class="form-row datetimepicker">
                <label for="node-input-datetimeInitialDate"><span data-i18n="node-line-bot-quick-reply-item.label.datetimeInitial"></span></label>
                <input style="width: 100px; margin-right: 10px;" type="text" id="node-input-datetimeInitialDate" placeholder="dd/mm/yyyy" />
                <input style="width: 85px;" type="time" id="node-input-datetimeInitialTime" placeholder="00:00" /><span class="lblTime">24h Time</span>
                <input type="hidden" id="node-input-InvalidInitialDatetime" />
                <div class="errorInvalidInitialDatetime"></div>
            </div>
            <div class="form-row datetimepicker">
                <label for="node-input-datetimeMinDate"><span data-i18n="node-line-bot-quick-reply-item.label.datetimeMin"></span></label>
                <input style="width: 100px; margin-right: 10px;" type="text" id="node-input-datetimeMinDate" placeholder="dd/mm/yyyy" />
                <input style="width: 85px;" type="time" id="node-input-datetimeMinTime" placeholder="00:00" /><span class="lblTime">24h Time</span>
                <input type="hidden" id="node-input-InvalidMinDatetime" />
                <div class="errorInvalidMinDatetime"></div>
            </div>
            <div class="form-row datetimepicker">
                <label for="node-input-datetimeMaxDate"><span data-i18n="node-line-bot-quick-reply-item.label.datetimeMax"></span></label>
                <input style="width: 100px; margin-right: 10px;" type="text" id="node-input-datetimeMaxDate" placeholder="dd/mm/yyyy" />
                <input style="width: 85px;" type="time" id="node-input-datetimeMaxTime" placeholder="00:00" /><span class="lblTime">24h Time</span>
                <input type="hidden" id="node-input-InvalidMaxDatetime" />
                <div class="errorInvalidMaxDatetime"></div>
            </div>
            <div class="form-row datetimepicker">
                <div style="margin-top: 3px; font-size: 0.9em;">
                    <span data-i18n="node-line-bot-quick-reply-item.label.concernDatetime"></span> Min &le; Initial &le; Max
                </div>
            </div>
        </div>
        <div style="margin-top: 3px; font-size: 0.9em;">
            <a target="_blank" href="https://developers.line.biz/en/reference/messaging-api/#action-objects"><i class="fa fa-external-link"></i> <span data-i18n="node-line-bot-quick-reply-item.label.gotoActionObjects"></span></a>
        </div>
    </div>
</script>
<script type="text/javascript">
    const ACTION_MESSAGE = "message";
    const ACTION_POSTBACK = "postback";
    const ACTION_URI = "uri";
    const ACTION_DATETIMEPICKER = "datetimepicker";
    const DATETIME_MODE_DATETIME = "datetime";
    const DATETIME_MODE_DATE = "date";
    const DATETIME_MODE_TIME = "time";

    function setDisplay(action) {
        if (action === "postback") {
            $('.postback').show();
            $('.message').hide();
            $('.uri').hide();
            $('.datetimepicker').hide();
        } else if (action === "message") {
            $('.postback').hide();
            $('.message').show();
            $('.uri').hide();
            $('.datetimepicker').hide();
        } else if (action === "uri") {
            $('.postback').hide();
            $('.message').hide();
            $('.uri').show();
            $('.datetimepicker').hide();
        } else if (action === "datetimepicker") {
            $('.postback').hide();
            $('.message').hide();
            $('.uri').hide();
            $('.datetimepicker').show();
        } else {
            $('.postback').hide();
            $('.message').hide();
            $('.uri').hide();
            $('.datetimepicker').hide();
        }
    }

    function setDisplay4Datetime(mode) {
        // gathering error
        const InvalidInitialDatetime = $("#node-input-InvalidInitialDatetime").val();
        const InvalidMinDatetime = $("#node-input-InvalidMinDatetime").val();
        const InvalidMaxDatetime = $("#node-input-InvalidMaxDatetime").val();
        // default hide invalid message
        $('.errorInvalidInitialDatetime').hide();
        $('.errorInvalidMinDatetime').hide();
        $('.errorInvalidMaxDatetime').hide();
        if (mode === DATETIME_MODE_DATETIME) {  // Mode 'Datetime'
            $('#node-input-datetimeInitialDate').show();
            $('#node-input-datetimeInitialTime').show();
            $('#node-input-datetimeMinDate').show();
            $('#node-input-datetimeMinTime').show();
            $('#node-input-datetimeMaxDate').show();
            $('#node-input-datetimeMaxTime').show();
            $('.lblTime').show();
            if (InvalidInitialDatetime !== "") {
                $('#node-input-datetimeInitialDate').addClass("error-box");
                $('#node-input-datetimeInitialTime').addClass("error-box");
                $('.errorInvalidInitialDatetime').show();
                $('.errorInvalidInitialDatetime').text(InvalidInitialDatetime);
            }
            if (InvalidMinDatetime !== "") {
                $('#node-input-datetimeMinDate').addClass("error-box");
                $('#node-input-datetimeMinTime').addClass("error-box");
                $('.errorInvalidMinDatetime').show();
                $('.errorInvalidMinDatetime').text(InvalidMinDatetime);
            }
            if (InvalidMaxDatetime !== "") {
                $('#node-input-datetimeMaxDate').addClass("error-box");
                $('#node-input-datetimeMaxTime').addClass("error-box");
                $('.errorInvalidMaxDatetime').show();
                $('.errorInvalidMaxDatetime').text(InvalidMaxDatetime);
            }
        } else if (mode === DATETIME_MODE_DATE) {  // Mode 'Date'
            $('#node-input-datetimeInitialDate').show();
            $('#node-input-datetimeInitialTime').hide();
            $('#node-input-datetimeMinDate').show();
            $('#node-input-datetimeMinTime').hide();
            $('#node-input-datetimeMaxDate').show();
            $('#node-input-datetimeMaxTime').hide();
            $('.lblTime').hide();
            if (InvalidInitialDatetime !== "") {
                $('#node-input-datetimeInitialDate').addClass("error-box");
                $('.errorInvalidInitialDatetime').show();
                $('.errorInvalidInitialDatetime').text(InvalidInitialDatetime);
            }
            if (InvalidMinDatetime !== "") {
                $('#node-input-datetimeMinDate').addClass("error-box");
                $('.errorInvalidMinDatetime').show();
                $('.errorInvalidMinDatetime').text(InvalidMinDatetime);
            }
            if (InvalidMaxDatetime !== "") {
                $('#node-input-datetimeMaxDate').addClass("error-box");
                $('.errorInvalidMaxDatetime').show();
                $('.errorInvalidMaxDatetime').text(InvalidMaxDatetime);
            }
        } else if (mode === DATETIME_MODE_TIME) {  // Mode 'Time'
            $('#node-input-datetimeInitialDate').hide();
            $('#node-input-datetimeInitialTime').show();
            $('#node-input-datetimeMinDate').hide();
            $('#node-input-datetimeMinTime').show();
            $('#node-input-datetimeMaxDate').hide();
            $('#node-input-datetimeMaxTime').show();
            $('.lblTime').show();
            if (InvalidInitialDatetime !== "") {
                $('#node-input-datetimeInitialTime').addClass("error-box");
                $('.errorInvalidInitialDatetime').show();
                $('.errorInvalidInitialDatetime').text(InvalidInitialDatetime);
            }
            if (InvalidMinDatetime !== "") {
                $('#node-input-datetimeMinTime').addClass("error-box");
                $('.errorInvalidMinDatetime').show();
                $('.errorInvalidMinDatetime').text(InvalidMinDatetime);
            }
            if (InvalidMaxDatetime !== "") {
                $('#node-input-datetimeMaxTime').addClass("error-box");
                $('.errorInvalidMaxDatetime').show();
                $('.errorInvalidMaxDatetime').text(InvalidMaxDatetime);
            }
        } else {      // Other Mode -> not have mode
            $('#node-input-datetimeInitialDate').show();
            $('#node-input-datetimeInitialTime').show();
            $('#node-input-datetimeMinDate').show();
            $('#node-input-datetimeMinTime').show();
            $('#node-input-datetimeMaxDate').show();
            $('#node-input-datetimeMaxTime').show();
            $('.lblTime').show();
        }
    }

    // clear postback action values
    function clearPostback() {
        $('#node-input-postbackData').val("");
        $('#node-input-postbackDisplayText').val("");
    }

    // clear message action values
    function clearMessage() {
        $('#node-input-messageText').val("");
    }

    // clear uri action values
    function clearUri() {
        $('#node-input-uri').val("");
        $('#node-input-altUriDesktop').val("");
    }

    // clear datetimepicker action all values
    function clearAllDatetime() {
        $('#node-input-datetimeData').val("");
        $('#node-input-datetimeMode').val("");
        $('#node-input-datetimeInitialDate').val("");
        $('#node-input-datetimeInitialTime').val("");
        $('#node-input-datetimeMinDate').val("");
        $('#node-input-datetimeMinTime').val("");
        $('#node-input-datetimeMaxDate').val("");
        $('#node-input-datetimeMaxTime').val("");
    }

    // clear datetimepicker action only date values
    function clearDate() {
        $('#node-input-datetimeInitialDate').val("");
        $('#node-input-datetimeMinDate').val("");
        $('#node-input-datetimeMaxDate').val("");
    }

    // clear datetimepicker action only time values
    function clearTime() {
        $('#node-input-datetimeInitialTime').val("");
        $('#node-input-datetimeMinTime').val("");
        $('#node-input-datetimeMaxTime').val("");
    }

    // func clear data by specific date or time
    function clearSpecifyDatetime(mode) {
        if (mode === DATETIME_MODE_DATE) {
            clearTime();
        } else if (mode === DATETIME_MODE_TIME) {
            clearDate();
        }
    }

    // func clear not use data before save
    function clearNotUseData(action) {
        if (action === ACTION_POSTBACK) {
            clearMessage();
            clearUri();
            clearAllDatetime();
        } else if (action === ACTION_MESSAGE) {
            clearPostback();
            clearUri();
            clearAllDatetime();
        } else if (action === ACTION_URI) {
            clearPostback();
            clearMessage();
            clearAllDatetime();
        } else if (action === ACTION_DATETIMEPICKER) {
            clearPostback();
            clearMessage();
            clearUri();
            clearSpecifyDatetime($("#node-input-datetimeMode").typedInput('value'));
        } else {
            clearPostback();
            clearMessage();
            clearUri();
            clearAllDatetime();
        }
    }

    function convertDate(strDate) {
        const parts = strDate.split("/");
        return parts[2] + "-" + parts[1] + "-" + parts[0];
    }

    function createDate(strDate, strTime) {
        const dateParts = strDate.split("/");
        const timeParts = strTime.split(":");
        const objDate = new Date(
            parseInt(dateParts[2]),
            parseInt(dateParts[1]) - 1,
            parseInt(dateParts[0]),
            parseInt(timeParts[0]),
            parseInt(timeParts[1]),
            0,
            0);
        return objDate;
    }

    function isValidUrl(value) {
        const result = value.match(/^(http|https):\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);
        return (result !== null);
    };

    function isValidTel(value) {
        const result = value.match(/^(tel:)[0-9]{9,10}$/);
        return (result !== null);
    }

    // Validates that the input string is a valid date formatted as "mm/dd/yyyy"
    function isValidDate(dateString) {
        // First check for the pattern
        if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
            return false;

        // Parse the date parts to integers
        const parts = dateString.split("/");
        const day = parseInt(parts[0], 10);
        const month = parseInt(parts[1], 10);
        const year = parseInt(parts[2], 10);

        // Check the ranges of month and year
        if (year < 1900 || year > 2100 || month == 0 || month > 12)
            return false;

        const monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        // Adjust for leap years
        if (year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))
            monthLength[1] = 29;

        // Check the range of the day
        return day > 0 && day <= monthLength[month - 1];
    };

    // Validates that the input string is a valid date formatted as "mm/dd/yyyy"
    function isValidTime(timeString) {
        // First check for the pattern
        if (!/^\d{2}\:\d{2}$/.test(timeString))
            return false;

        // Parse the date parts to integers
        var parts = timeString.split(":");
        var hour = parseInt(parts[0], 10);
        var minute = parseInt(parts[1], 10);

        // Check the ranges of month and year
        if (hour > 23 || minute > 59)
            return false;

        return true;
    };

    function setInvalidDatetimeValues(type, strError) {
        if (type === "initial") {   // initial
            $("#node-input-InvalidInitialDatetime").val(strError);
        } else if (type === "max") {    // max
            $("#node-input-InvalidMaxDatetime").val(strError);
        } else {    // min
            $("#node-input-InvalidMinDatetime").val(strError);
        }
    }

    RED.nodes.registerType('node-line-bot-quick-reply-item', {
        category: "LINE API",
        color: "#00b900",
        icon: "icons/quick.svg",
        defaults: {
            name: {
                value: ""
            },
            action: {
                value: "",
                required: true
            },
            imageUrl: {
                value: ""
            },
            replyLabel: {   // required, Max character limit: 20
                value: "",
                required: true,
                validate: function (v) {
                    return v.length <= 20 && v.length > 0 && !v.match(/^\s*$/);
                }
            },
            postbackData: { // required, Max character limit: 300
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_POSTBACK) {
                        return v.length <= 300 && v.length > 0 && !v.match(/^\s*$/);
                    } else {
                        return true;
                    }
                }
            },
            postbackDisplayText: {  // required, Max character limit: 300
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_POSTBACK) {
                        return v.length <= 300 && v.length > 0 && !v.match(/^\s*$/);
                    } else {
                        return true;
                    }
                }
            },
            messageText: {  // required, Max character limit: 300
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_MESSAGE) {
                        return v.length <= 300 && v.length > 0 && !v.match(/^\s*$/);
                    } else {
                        return true;
                    }
                }
            },
            uri: {  // required
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_URI) {
                        if (!v.match(/^\s*$/)) {
                            if (v.length <= 300 && v.length > 0) {
                                return isValidTel(v) || isValidUrl(v);
                            } else {
                                return false;
                            }
                        } else {
                            return false;
                        }
                    } else {
                        return true;
                    }
                }
            },
            altUriDesktop: {
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_URI) {
                        if (!v.match(/^\s*$/)) {
                            if (v.length <= 1000 && v.length > 0) {
                                return isValidTel(v) || isValidUrl(v);
                            } else if (v.length > 1000) {
                                return false;
                            }
                        } else {
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeData: { // required, Max character limit: 300
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        return v.length <= 300 && v.length > 0 && !v.match(/^\s*$/);
                    } else {
                        return true;
                    }
                }
            },
            datetimeMode: { // required, include: date, time, datetime
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        return !v.match(/^\s*$/);
                    } else {
                        return true;
                    }
                }
            },
            selectedDatetimeMode: {
                value: ""
            },
            datetimeInitialDate: {  // optional
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATE) {   // Mode 'Datetime' and 'Date'
                            if (!v.match(/^\s*$/)) {  // if there is date, no interest time -> validate date
                                return isValidDate(v);
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Time'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeInitialTime: {  // optional
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_TIME) {   // Mode 'Datetime' and 'Time'
                            if (!v.match(/^\s*$/)) {
                                return isValidTime(v);
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Date'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeMaxDate: {  // max must more than min
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATE) {   // Mode 'Datetime' and 'Date'
                            if (!v.match(/^\s*$/)) {
                                return isValidDate(v);
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Time'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeMaxTime: {  // optional
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_TIME) {   // Mode 'Datetime' and 'Time'
                            if (!v.match(/^\s*$/)) {
                                return isValidTime(v);;
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Date'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeMinDate: {  // min must less than max
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATE) {   // Mode 'Datetime' and 'Date'
                            if (!v.match(/^\s*$/)) {
                                return isValidDate(v);
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Time'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            datetimeMinTime: {  // optional
                value: "",
                validate: function (v) {
                    if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                        if ($("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_DATETIME || $("#node-input-selectedDatetimeMode").val() === DATETIME_MODE_TIME) {   // Mode 'Datetime' and 'Time'
                            if (!v.match(/^\s*$/)) {
                                return isValidTime(v);;
                            } else {
                                return true;
                            }
                        } else {    // Mode 'Date'
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
            },
            useQuickReplyItem: {
                value: true
            },
            InvalidInitialDatetime: {
                value: "",
                validate: function (v) {
                    return v === "";
                }
            },
            InvalidMinDatetime: {
                value: "",
                validate: function (v) {
                    return v === "";
                }
            },
            InvalidMaxDatetime: {
                value: "",
                validate: function (v) {
                    return v === "";
                }
            }
        },
        paletteLabel: "quick reply item",
        align: 'right',
        label: function () {
            return this.name || "Quick Reply Item";
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        inputs: 1,
        outputs: 1,
        oneditprepare: function () {
            // initial input 'action'
            $("#node-input-action").typedInput({
                types: [
                    {
                        value: "action",
                        options: [
                            { value: "", label: "--Choose One--" },
                            { value: "message", label: "Message" },
                            { value: "uri", label: "URI" },
                            { value: "cameraRoll", label: "Camera Roll" },
                            { value: "camera", label: "Camera" },
                            { value: "location", label: "Location" },
                            { value: "postback", label: "Postback" },
                            { value: "datetimepicker", label: "Datetime Picker" }
                        ]
                    }
                ]
            });
            // initial input 'datetime mode'
            $("#node-input-datetimeMode").typedInput({
                types: [
                    {
                        value: "mode",
                        options: [
                            { value: "", label: "--Choose One--" },
                            { value: "date", label: "Date" },
                            { value: "time", label: "Time" },
                            { value: "datetime", label: "Datetime" }
                        ]
                    }
                ]
            });
            $("#node-input-action").on("change", (event, type, value) => {
                // set appropriate input for each action
                setDisplay(value);
            });
            $("#node-input-datetimeMode").on("change", (event, type, value) => {
                // Keep selected Datetime Mode
                $("#node-input-selectedDatetimeMode").val(value);
                // set appropriate input for each action
                setDisplay4Datetime(value);
            });
            $("#node-input-datetimeInitialDate").datepicker({   // set properties
                dateFormat: "dd/mm/yy",
                minDate: new Date(1900, 0, 1),
                maxDate: new Date(2100, 11, 31)
            });
            $("#node-input-datetimeMaxDate").datepicker({   // set properties
                dateFormat: "dd/mm/yy",
                minDate: new Date(1900, 0, 1),
                maxDate: new Date(2100, 11, 31)
            });
            $("#node-input-datetimeMinDate").datepicker({   // set properties
                dateFormat: "dd/mm/yy",
                minDate: new Date(1900, 0, 1),
                maxDate: new Date(2100, 11, 31)
            });
            // set display input by action type
            setDisplay($("#node-input-action").typedInput('value'));
            // set display input datetime section by datetime picker mode
            setDisplay4Datetime($("#node-input-datetimeMode").typedInput('value'));
        },
        oneditsave: function () {
            // Clear not use data before save
            clearNotUseData($("#node-input-action").typedInput('value'));
            // if action = datetimepicker then validate date & time
            if ($("#node-input-action").typedInput('value') === ACTION_DATETIMEPICKER) {
                const mode = $("#node-input-selectedDatetimeMode").val();
                const initialDate = $("#node-input-datetimeInitialDate").val();
                const initialTime = $("#node-input-datetimeInitialTime").val();
                const minDate = $("#node-input-datetimeMinDate").val();
                const minTime = $("#node-input-datetimeMinTime").val();
                const maxDate = $("#node-input-datetimeMaxDate").val();
                const maxTime = $("#node-input-datetimeMaxTime").val();

                if (mode === DATETIME_MODE_DATETIME) {  // === Validate mode 'Datetime' ===
                    // if every pair Date&Time are empty, or each pair Date&Time has only one value, then validate pass
                    if ((initialDate.match(/^\s*$/) && initialTime.match(/^\s*$/) && minDate.match(/^\s*$/) && minTime.match(/^\s*$/) && maxDate.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (!initialDate.match(/^\s*$/) && !initialTime.match(/^\s*$/) && minDate.match(/^\s*$/) && minTime.match(/^\s*$/) && maxDate.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (initialDate.match(/^\s*$/) && initialTime.match(/^\s*$/) && !minDate.match(/^\s*$/) && !minTime.match(/^\s*$/) && maxDate.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (initialDate.match(/^\s*$/) && initialTime.match(/^\s*$/) && minDate.match(/^\s*$/) && minTime.match(/^\s*$/) && !maxDate.match(/^\s*$/) && !maxTime.match(/^\s*$/))) {
                        setInvalidDatetimeValues("initial", "");
                        setInvalidDatetimeValues("min", "");
                        setInvalidDatetimeValues("max", "");
                    } else {
                        let passValidate = true;
                        // Validate have/not have both 'Date' & 'Time' value 
                        if ((initialDate.match(/^\s*$/) && !initialTime.match(/^\s*$/)) || (!initialDate.match(/^\s*$/) && initialTime.match(/^\s*$/))) {
                            setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.initialDateAndTimeMustSame"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("initial", "");
                        }
                        if ((minDate.match(/^\s*$/) && !minTime.match(/^\s*$/)) || (!minDate.match(/^\s*$/) && minTime.match(/^\s*$/))) {
                            setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.minDateAndTimeMustSame"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("min", "");
                        }
                        if ((maxDate.match(/^\s*$/) && !maxTime.match(/^\s*$/)) || (!maxDate.match(/^\s*$/) && maxTime.match(/^\s*$/))) {
                            setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxDateAndTimeMustSame"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("max", "");
                        }
                        // if validation has pass, then compare date and time
                        if (passValidate) {
                            // Compare between 'initial' and 'min'
                            if (!initialDate.match(/^\s*$/) && !initialTime.match(/^\s*$/) && !minDate.match(/^\s*$/) && !minTime.match(/^\s*$/)) {
                                if (createDate(minDate, minTime) > createDate(initialDate, initialTime)) {
                                    setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                                    setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                                    passValidate = false;
                                } else {
                                    setInvalidDatetimeValues("initial", "");
                                    setInvalidDatetimeValues("min", "");
                                    passValidate = true;
                                }
                                setInvalidDatetimeValues("max", "");
                            }
                            // Compare between 'initial' and 'max'
                            if (passValidate && !initialDate.match(/^\s*$/) && !initialTime.match(/^\s*$/) && !maxDate.match(/^\s*$/) && !maxTime.match(/^\s*$/)) {
                                if (createDate(initialDate, initialTime) > createDate(maxDate, maxTime)) {
                                    setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                                    setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                                    passValidate = false;
                                } else {
                                    setInvalidDatetimeValues("initial", "");
                                    setInvalidDatetimeValues("max", "");
                                    passValidate = true;
                                }
                                setInvalidDatetimeValues("min", "");
                            }
                            // Compare between 'min' and 'max'
                            if (passValidate && !minDate.match(/^\s*$/) && !minTime.match(/^\s*$/) && !maxDate.match(/^\s*$/) && !maxTime.match(/^\s*$/)) {
                                if (createDate(minDate, minTime) > createDate(maxDate, maxTime)) {
                                    setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                                    setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                                    passValidate = false;
                                } else {
                                    setInvalidDatetimeValues("min", "");
                                    setInvalidDatetimeValues("max", "");
                                    passValidate = true;
                                }
                                setInvalidDatetimeValues("initial", "");
                            }
                        }
                    }
                } else if (mode === DATETIME_MODE_DATE) {   // === Validate mode 'Date' ===
                    let passValidate = true;
                    // if every Date are empty, or each time has only one value, then validate pass
                    if ((initialDate.match(/^\s*$/) && minDate.match(/^\s*$/) && maxDate.match(/^\s*$/)) ||
                        (!initialDate.match(/^\s*$/) && minDate.match(/^\s*$/) && maxDate.match(/^\s*$/)) ||
                        (initialDate.match(/^\s*$/) && !minDate.match(/^\s*$/) && maxDate.match(/^\s*$/)) ||
                        (initialDate.match(/^\s*$/) && minDate.match(/^\s*$/) && !maxDate.match(/^\s*$/))) {
                        setInvalidDatetimeValues("initial", "");
                        setInvalidDatetimeValues("min", "");
                        setInvalidDatetimeValues("max", "");
                        passValidate = true;
                    }
                    // Compare between 'initial' and 'min'
                    if (passValidate && !initialDate.match(/^\s*$/) && !minDate.match(/^\s*$/)) {
                        if (new Date(convertDate(minDate)) > new Date(convertDate(initialDate))) {
                            setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                            setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("initial", "");
                            setInvalidDatetimeValues("min", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("max", "");
                    }
                    // Compare between 'initial' and 'max'
                    if (passValidate && !initialDate.match(/^\s*$/) && !maxDate.match(/^\s*$/)) {
                        if (new Date(convertDate(initialDate)) > new Date(convertDate(maxDate))) {
                            setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                            setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("initial", "");
                            setInvalidDatetimeValues("max", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("min", "");
                    }
                    // Compare between 'min' and 'max'
                    if (passValidate && !minDate.match(/^\s*$/) && !maxDate.match(/^\s*$/)) {
                        if (new Date(convertDate(minDate)) > new Date(convertDate(maxDate))) {
                            setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                            setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("min", "");
                            setInvalidDatetimeValues("max", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("initial", "");
                    }
                } else {   // === Validate mode 'Time' ===
                    let passValidate = true;
                    // if every time are empty, or each time has only one value, then validate pass
                    if ((initialTime.match(/^\s*$/) && minTime.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (!initialTime.match(/^\s*$/) && minTime.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (initialTime.match(/^\s*$/) && !minTime.match(/^\s*$/) && maxTime.match(/^\s*$/)) ||
                        (initialTime.match(/^\s*$/) && minTime.match(/^\s*$/) && !maxTime.match(/^\s*$/))) {
                        setInvalidDatetimeValues("initial", "");
                        setInvalidDatetimeValues("min", "");
                        setInvalidDatetimeValues("max", "");
                        passValidate = true;
                    }
                    // Compare between 'initial' and 'min'
                    if (passValidate && !initialTime.match(/^\s*$/) && !minTime.match(/^\s*$/)) {
                        if (Date.parse("01/01/2011 " + minTime + ":00") > Date.parse("01/01/2011 " + initialTime + ":00")) {
                            setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                            setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.minMustLessThanOrEqualInitial"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("initial", "");
                            setInvalidDatetimeValues("min", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("max", "");
                    }
                    // Compare between 'initial' and 'max'
                    if (passValidate && !initialTime.match(/^\s*$/) && !maxTime.match(/^\s*$/)) {
                        if (Date.parse("01/01/2011 " + initialTime + ":00") > Date.parse("01/01/2011 " + maxTime + ":00")) {
                            setInvalidDatetimeValues("initial", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                            setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualInitial"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("initial", "");
                            setInvalidDatetimeValues("max", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("min", "");
                    }
                    // Compare between 'min' and 'max'
                    if (passValidate && !minTime.match(/^\s*$/) && !maxTime.match(/^\s*$/)) {
                        if (Date.parse("01/01/2011 " + minTime + ":00") > Date.parse("01/01/2011 " + maxTime + ":00")) {
                            setInvalidDatetimeValues("min", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                            setInvalidDatetimeValues("max", this._("node-line-bot-quick-reply-item.errors.maxMustMoreThanOrEqualMin"));
                            passValidate = false;
                        } else {
                            setInvalidDatetimeValues("min", "");
                            setInvalidDatetimeValues("max", "");
                            passValidate = true;
                        }
                        setInvalidDatetimeValues("initial", "");
                    }
                }
            } else {    // Other action -> not check datetime, and pass validate datetime
                setInvalidDatetimeValues("initial", "");
                setInvalidDatetimeValues("min", "");
                setInvalidDatetimeValues("max", "");
            }
        }
    });
</script>